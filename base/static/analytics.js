!function(){if(!window.__betterlytics_analytics_initialized__){window.__betterlytics_analytics_initialized__=!0;var t=document.currentScript||document.querySelector('script[src*="analytics.js"]'),e=t.getAttribute("data-site-id"),r=t.getAttribute("data-server-url"),n=t.getAttribute("data-dynamic-urls")?.split(",").map(function(t){return{original:t=t.trim(),regex:RegExp(`^${t.replace(/\*\*/g,"(.+)").replace(/\*/g,"([^/]+)")}`)}})??[],i=t.getAttribute("data-scripts-base-url")??"https://betterlytics.io",a=t.getAttribute("data-outbound-links")??"domain",s="true"===t.getAttribute("data-web-vitals"),o="true"===t.getAttribute("data-replay"),c="true"===t.getAttribute("data-consent-replay"),l=parseInt(t.getAttribute("data-replay-sample")||"5",10);if((isNaN(l)||l<0||l>100)&&(l=0),!e)return console.error("Betterlytics: data-site-id attribute missing");if(!r)return console.error("Betterlytics: data-server-url attribute missing");var u=window.location.pathname,p=window.betterlytics&&window.betterlytics.q||[],d=[];window.betterlytics={event:(t,e={})=>C(t,{is_custom_event:!0,properties:JSON.stringify(e)}),setReplayConsent:function(t){var e="betterlytics:replay_consent";try{t?localStorage.setItem(e,JSON.stringify({consented:!0,source:"custom",timestamp:Date.now()})):localStorage.removeItem(e);for(var r=0;r<d.length;r++)d[r](t)}catch(n){console.error("Failed to set replay consent:",n)}}};for(var f=0;f<p.length;f++)window.betterlytics.event.apply(this,p[f]);if(s){var y=new Map,m=!1;function v(t){y.set(t.name,{name:t.name,value:t.value,id:t.id,rating:t.rating,delta:t.delta,navigationType:t.navigationType})}function g(){if(!m&&0!==y.size){m=!0;var t=Array.from(y.values()).reduce(function(t,e){return t[e.name]=e.value,t},{});C("cwv",{cwv_cls:t.CLS,cwv_lcp:t.LCP,cwv_inp:t.INP,cwv_fcp:t.FCP,cwv_ttfb:t.TTFB}),y.clear()}}document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&g()}),window.addEventListener("pagehide",function(){g()});var h=document.createElement("script");h.src="https://unpkg.com/web-vitals@5/dist/web-vitals.iife.js",h.async=!0,h.onload=function(){"undefined"!=typeof webVitals&&(webVitals.onCLS(v),webVitals.onINP(v),webVitals.onLCP(v),webVitals.onFCP(v),webVitals.onTTFB(v))},document.head.appendChild(h)}if(C("pageview"),window.history.pushState){var b=history.pushState;history.pushState=function(){b.apply(this,arguments),u!==window.location.pathname&&(u=window.location.pathname,C("pageview"))},window.addEventListener("popstate",function(){u!==window.location.pathname&&(u=window.location.pathname,C("pageview"))})}if(["domain","full"].includes(a)&&document.addEventListener("click",function(t){var e,r,n=t.target.closest("a");if(n&&n.href){let i=(e=n,!!(r=URL.parse(e.href,window.location.origin))&&r.hostname!==window.location.hostname&&""!==r.hostname&&("domain"===a?r.origin:r.origin+r.pathname));i&&C("outbound_link",{outbound_link_url:i})}}),o){var $="betterlytics:replay_sample",w=!1;function A(){try{var t=localStorage.getItem($),e=Date.now();if(t){var r=JSON.parse(t);if(e-r.timestamp<18e5)return localStorage.setItem($,JSON.stringify({sampled:r.sampled,timestamp:e})),r.sampled}var n=Math.round(100*Math.random())<=l;return localStorage.setItem($,JSON.stringify({sampled:n,timestamp:e})),n}catch(i){return Math.round(100*Math.random())<=l}}d.push(function(t){t&&!w&&A()?(w=!0,_(`${i}/replay.js`)):!t&&w&&window.__betterlytics_replay__&&window.__betterlytics_replay__.stop&&"function"==typeof window.__betterlytics_replay__.stop&&window.__betterlytics_replay__.stop()}),!w&&function t(){if(c)return!0;try{var e=localStorage.getItem("betterlytics:replay_consent");if(e){var r=JSON.parse(e);return!0===r.consented&&"custom"===r.source}}catch(n){}return!1}()&&A()&&(w=!0,_(`${i}/replay.js`))}}function C(t,i={}){var a,s=function t(e){for(var r=new URL(e),i=r.pathname,a=0;a<n.length;a++){var s=n[a].regex.exec(i);if(s)return`${r.origin}${n[a].original.replace(/\*\*/g,"*")}${i.slice(s[0].length)}${r.search}${r.hash}`}return e}(window.location.href),o=document.referrer||null;fetch(r,{method:"POST",keepalive:!0,headers:{"Content-Type":"application/json"},body:JSON.stringify({site_id:e,event_name:t,is_custom_event:!1,properties:"{}",url:s,referrer:o,user_agent:navigator.userAgent,screen_resolution:window.screen.width+"x"+window.screen.height,timestamp:Math.floor(Date.now()/1e3),...i})}).then(t=>t.text()).catch(function(t){console.error("Analytics tracking failed:",t)})}function _(t){return new Promise(function(e,r){var n=document.createElement("script");n.src=t,n.async=!0,n.onload=function(){e()},n.onerror=function(t){r(t)},document.head.appendChild(n)})}}();