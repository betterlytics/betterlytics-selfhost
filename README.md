# Betterlytics - Self-Hosted

Betterlytics is a modern, privacy-first analytics platform that provides powerful insights about your website traffic without compromising user privacy.
This repository provides everything you need to deploy Betterlytics on your own infrastructure using Docker.

## Quick Start

### 1. Configure

Run the interactive setup script to generate a `.env` file with secure random secrets:

```bash
chmod +x setup.sh
./setup.sh
```

Or copy `.env.example` to `.env` and fill in the values manually.

### 2. Deploy

```bash
docker compose up -d
```

### 3. Verify

```bash
curl http://localhost/health
```

## Deployment Modes

### Standalone (automatic HTTPS)

Set `ENABLE_HTTPS=true` in your `.env` file. Caddy will automatically provision TLS certificates via Let's Encrypt using the configured `DOMAIN` and `ACME_EMAIL`.

Ports 80 and 443 must be accessible from the internet for ACME challenges and HTTPS traffic.

### Behind a Reverse Proxy

Set `ENABLE_HTTPS=false` (default). Caddy listens on HTTP only, and trusts `X-Forwarded-For` headers from private IP ranges (RFC 1918). Point your external reverse proxy (nginx, Traefik, Cloudflare, etc.) to the configured `HTTP_PORT` (default: 80).

Rate limiting should be configured on your external reverse proxy in this mode.

## Health Check

The `/health` endpoint proxies to the backend service. A `200` response means the backend is healthy. A `502` means the proxy is up but the backend is unreachable.

## Configuration Reference

| Variable | Description | Default |
|---|---|---|
| `ENABLE_HTTPS` | Enable automatic HTTPS via Let's Encrypt | `false` |
| `DOMAIN` | Your Betterlytics domain | `localhost` |
| `ACME_EMAIL` | Email for Let's Encrypt notifications | |
| `HTTP_PORT` | Host port for HTTP traffic | `80` |
| `HTTPS_PORT` | Host port for HTTPS traffic | `443` |
| `PUBLIC_BASE_URL` | Full public URL of your instance | |
| `ADMIN_EMAIL` | Admin account email | |
| `ADMIN_PASSWORD` | Admin account password | |
| `ENABLE_GEOLOCATION` | Enable IP geolocation (requires MaxMind) | `false` |
| `MAXMIND_ACCOUNT_ID` | MaxMind account ID | |
| `MAXMIND_LICENSE_KEY` | MaxMind license key | |

Database passwords, `NEXTAUTH_SECRET`, and `TOTP_SECRET_ENCRYPTION_KEY` are auto-generated by `setup.sh`. See `.env.example` for the full list.

## Requirements

- Docker and Docker Compose
- A domain name pointed to your server
- Ports 80/443 open (standalone mode) or a reverse proxy configured (behind-proxy mode)

## Documentation

For detailed instructions, advanced configuration, and troubleshooting, see the [Self-Hosting Guide](https://betterlytics.io/docs/installation/self-hosting).
